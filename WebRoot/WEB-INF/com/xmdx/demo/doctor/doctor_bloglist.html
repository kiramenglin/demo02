<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>个人博客</title>
<style type="text/css">

</style>

<link href="css/css/bootstrap.min.css" rel="stylesheet" />
<link href="css/css/bootstrap-theme.css" rel="stylesheet" />
<link href="css/pagination.css" rel="stylesheet" />
<script src="/e9common/bootstrap/js/jquery-1.11.0.min.js"></script> 
<script type="text/javascript" src="js/js/bootstrap.min.js"></script> 
<script type="text/javascript" src="js/websiteCommon.js"></script>  
<script type="text/javascript" src="js/jquery.pagination.js"></script> 
<script type="text/javascript">

/**
 * 初始化分页栏
 * @param paperId 分页栏ID
 * @param data 后台返回值
 * @param afterSuccess 回调函数
 * @param options 参数设置
 */
function initPager(paperId, data, afterSuccess, options,isnonedata){
	
	initPagerWithData(paperId, data.CurrentPage, data.TotalPage, data.TotalRows, afterSuccess, options,isnonedata);
}

/**
 * 初始化分页栏
 * @param paperId 分页栏ID
 * @param currPage 当前页
 * @param totalPage 总页数
 * @param totalRows 总记录数
 * @param afterSuccess 回调函数
 * @param options 参数设置
 */
function initPagerWithData(paperId, currPage, totalPage, totalRows, afterSuccess, options,isnonedata){
	
	//分页栏起始页码的判定：1、总页数 <= pageBtnNum，那么下标从 1 到 总页数； 2、总页数 > pageBtnNum && 当前页 <= pageBtnNum/2，那么下标从 1 到 pageBtnNum
	//3、否则 从当前页开始，昨天显示 pageBtnNum/2 个按钮，余下的算右边
	//属性含义：每页记录数，第几页，分页栏中共显示多少个按钮，是否显示首尾、上下页的按钮('1':显示)，是否显示“益玖为您找到 X 条记录”('1':显示)，当只有一页时是否显示分页栏
	var pagerJson = $.extend({},{
		"pageSize" : 10,
		"pageNumber" : 1,
		"pageBtnNum" : 8,
		"showHeadAndTail": "1",
		"showTotalRecord" : "1",
		"hidePaperOnOnePage": "1"
	}, options);
	
	var html = '';
	var pageBtnNum = parseInt(pagerJson.pageBtnNum);
	var pageNumber = parseInt(pagerJson.pageNumber);
	
	//循环起始下标、截止下标； 当前页按钮左边有几个按钮，右边有几个按钮
	var startIndex = 0;
	var lastIndex = 0;
	var currLeftNum = (pageBtnNum / 2).toFixed(0);
	var currRightNum = ((pageBtnNum / 2) - 1).toFixed(0);
	if(parseInt(totalPage) <= pageBtnNum) {
		startIndex = 1;
		lastIndex = totalPage;
	}else if(parseInt(currPage) <= currLeftNum){
		startIndex = 1;
		lastIndex = pageBtnNum;
	}else{
		if(parseInt(currPage) + parseInt(currRightNum) <= parseInt(totalPage)){
			startIndex = parseInt(currPage) - parseInt(currLeftNum);
			lastIndex = parseInt(currPage) + parseInt(currRightNum);
		}else{
			lastIndex = totalPage;
			startIndex = parseInt(totalPage) - parseInt(pageBtnNum) + 1;
		}
	}
	
	for ( var index = startIndex; index <= lastIndex; index++) {
		if(parseInt(currPage) != parseInt(index)){
			html += '<li data-index="' + index + '"><a href="javascript:void(0)">' + index + '</a></li>';
		}else{
			html += '<li class="active" data-index="' + index + '"><a href="javascript:void(0)">' + index + '</a></li>';
		}
	}
	
	//当前页等于1：首页、上一页不可点击；等于最后一页：尾页、下一页不可点击
	if(parseInt(totalPage) != 0 && ( parseInt(totalPage) > parseInt(pageBtnNum) || pagerJson.showHeadAndTail == "1")) {
		var cls = '';
		if(parseInt(currPage) == 1){
			cls = ' class="disabled" ';
		}
		var headHtml = '<li' + cls + ' data-index="1"><a href="javascript:void(0)">首页</a></li>';
		headHtml += '<li' + cls + ' data-index="' + (parseInt(currPage) - 1) + '"><a href="javascript:void(0)">上一页</a></li>';	
		
		cls = '';
		if(parseInt(currPage) == parseInt(totalPage)){
			cls = ' class="disabled" ';
		}
		var tailHtml = '<li' + cls + ' data-index="' + (parseInt(currPage) + 1) + '"><a href="javascript:void(0)">下一页</a></li>';
		tailHtml += '<li' + cls + ' data-index="' + totalPage + '"><a class="paper-last-page" href="javascript:void(0)">尾页</a></li>';
	
		html = headHtml + html + tailHtml;
	}
	
	if(parseInt(totalPage) == 0){
		if(!isnonedata){
			html = '<span class="text-muted" style="font-size:14px;">暂无数据</span>';
		}
	}else if(pagerJson.showTotalRecord == "1"){
		html = '<ul class="pagination">' + html + '<li><span>找到 ' + totalRows + ' 条记录</span></li></ul>';
	}else{
		html = '<ul class="pagination">' + html + '</ul>';
	}
	
	if(pagerJson.hidePaperOnOnePage == "1" && parseInt(totalPage) == 1){
		//清空内容
		$("#" + paperId).html("");
		return;
	}

	$("#" + paperId).html( html).find("li").not(".active,.disabled").click(function(){
		
		var dataIndex = $(this).attr("data-index");
		
		if(afterSuccess && dataIndex){
			
			afterSuccess.call(this, $(this).attr("data-index"), pagerJson.pageSize);
			alert("enter click3");
			
		}
		
	});
}

var data = {
		CurrentPage :"@{PAGE_BEAN.get('CurrentPage')}",	
		TotalPage : "@{PAGE_BEAN.get('TotalPage')}",
		TotalRows : "@{PAGE_BEAN.get('TotalRows')}"
	};
$(document).ready(function(){
	/* myProject(); */
	
	initPager("pageBar", data, function(pageNumber, pageSize){
		 myProject({
			rows :  pageSize,
			page : pageNumber
		}); 
	}, {
		pageSize :2,
		showHeadAndTail : 1,
		hidePaperOnOnePage:0
	});
	
});

function myProject(option){
	var params = $.extend({rows:10},option);
	$.webAjax("HttpChannel?action=INIT_ACTION&BUSINESS_TYPE=doctor.blog&TMP=" + new Date(),params,{
		dataType:"html",
		success:function(data){
			
			$('#modal_body').html(data);
		}
	
	});
}

function validate(){
	  document.getElementByIdx_x('infoForm').submit();
	}
window.load=validate();
</script>
</head>
<body>
	<div class="container-fluid">
		<div class="row">
			<div class="col-md-4">
				<h3 align="center">我的博客</h3>
			</div>
			<div class="col-md-8">
			</div>
		</div>
		<div class="row">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
				<h4 class="modal-title" id="myModalLabel">博客列表</h4>
			</div>
			@if{BLOGS.size() > 0}   
			@foreach{BLOG: BLOGS}
			<div class="modal-body" id="modal_body">
				<input type="hidden" style="width:90%" name="ID" id="ID" value="@{BLOG.get('ID')}"/>
				<a href="HttpChannel?action=GOTO_ACTION&BUSINESS_TYPE=doctor.blog"><h3 id = @{BLOG.get("ID")}>@{BLOG.get("TITLE")}</h3></a>
				<div>@{BLOG.get("CONTENT")}</div>
				<form method="post" name="infoForm" id="infoForm" action="HttpChannel?action=GOTO_ACTION&BUSINESS_TYPE=doctor.blog">
					
					<input  type="hidden"  name="ID" id="ID" value="@{BLOG.get('ID')}"><br>
					
					<input type="submit" value="修改">
				</form>
			<button type="button" class="btn btn-link" id="delBtn">删除</button>
			</div>
			@end{}
			@else{}
			<div class="modal-body">
			</div>
			@end{}			
		</div>
		<div class="btn-group">

			<a href="HttpChannel?action=COMMON_ACTION&BUSINESS_TYPE=doctor.blog!initBlog"
				class="btn btn-primary" role="button">新增</a>
			<button type="button" class="btn btn-primary" id="mdfBtn">修改</button>
			<button type="button" class="btn btn-primary" id="delBtn">删除</button>
			
		</div>
		<div class="text-center" >
			<ul id="pageBar" class="pagination pagination-lg">
		</ul>
	</div>
	</div>
</body>
</html>